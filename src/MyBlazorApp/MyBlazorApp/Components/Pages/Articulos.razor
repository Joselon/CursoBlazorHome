@page "/articulos"
@using MyBlazorApp.ViewModels
@inject MyBlazorApp.Services.IArticulosService ArticulosSvc

<PageTitle>Articulos</PageTitle>

<h1>Artículos</h1>

<!--<MudTable Items="articulos" Dense="true" Hover="true" Striped="true">
    <HeaderContent>
        <MudTh>Id</MudTh>
        <MudTh>Descripción</MudTh>
        <MudTh>Precio</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Id">@context.Id</MudTd>
        <MudTd DataLabel="Descripción">@context.Descripcion</MudTd>
        <MudTd DataLabel="Precio">@context.Precio</MudTd>
    </RowTemplate>
</MudTable>-->

<MudTable T="Articulo"
          ServerData="LoadServerData"
          Dense="true"
          Hover="true"
          Striped="true"
          RowsPerPage="10"
          SelectOnRowClick="true"
          @bind-SelectedItem="selectedArticulo"
          RowsPerPageOptions="new int[] { 10, 20, 50 }">

    <HeaderContent>
        <MudTh>Id</MudTh>
        <MudTh>Descripción</MudTh>
        <MudTh>Precio</MudTh>
    </HeaderContent>

    <RowTemplate>
        <MudTd DataLabel="Id">@context.Id</MudTd>
        <MudTd DataLabel="Descripción">@context.Descripcion</MudTd>
        <MudTd DataLabel="Precio">@context.Precio</MudTd>
    </RowTemplate>

    <PagerContent>
        <MudTablePager InfoFormat="{first_item}-{last_item} de {all_items}"
                       RowsPerPageString="Filas por página:" />
    </PagerContent>

</MudTable>

<hr />

Edite el Artículo:

<EditForm FormName="EditArticuloForm" Model="_articulo" OnValidSubmit="GuardarArticulo" class="d-flex gap-sm-0">
    <DataAnnotationsValidator></DataAnnotationsValidator>
   
    <label>Id:</label>
    <InputNumber class="form-control" @bind-Value="_articulo.Id" placeholder="nn" />
    <ValidationMessage For="() => _articulo.Id"></ValidationMessage>

    <label>Articulo:</label>
    <InputText class="form-control" @bind-Value="_articulo.Descripcion" placeholder="Descripcion" />

    <label>Precio:</label>
    <InputNumber class="form-control" @bind-Value="_articulo.Precio" placeholder="Precio" />

    <ValidationMessage For="() => _articulo.Precio"></ValidationMessage>
</EditForm>


@code {

    private Articulo _articulo { get; set; } = new Articulo();
    private Articulo? _selectedArticulo;

    private Articulo? selectedArticulo
    {
        get => _selectedArticulo;
        set
        {
            _selectedArticulo = value;

            if (value is null)
                return;

            _articulo = new Articulo
            {
                Id = value.Id,
                Descripcion = value.Descripcion,
                Precio = value.Precio
            };
        }
    }

    /*
    private List<Articulo>? articulos;
    
    protected override async Task OnInitializedAsync()
    {
        articulos = await ArticulosSvc.GetAllAsync();
    }
    */
    private async Task<TableData<Articulo>> LoadServerData(TableState state, CancellationToken cancellationToken)
    {
        // MudBlazor pasa página base 0, nuestro método usa base 1
        int pageToLoad = state.Page + 1;
        int pageSize = state.PageSize;

        var pagina = await ArticulosSvc.GetPageAsync(pageToLoad, pageSize);

        return new TableData<Articulo>
        {
            Items = pagina.Data,
            TotalItems = pagina.TotalRecords
        };
    }
    /*
    private void OnRowClick(TableRowClickEventArgs<Articulo> args)
    {
        selectedArticulo = args.Item;

        // Clonamos para no editar directamente la instancia de la tabla
        _articulo = new Articulo
        {
            Id = selectedArticulo.Id,
            Descripcion = selectedArticulo.Descripcion,
            Precio = selectedArticulo.Precio
        };
    }*/

    private async Task GuardarArticulo()
    {
       /* if (_articulo.Id == 0)
            await ArticulosSvc.AddAsync(_articulo);
        else
            await ArticulosSvc.UpdateAsync(_articulo);

         _articulo = new Articulo(); */
    }


}

